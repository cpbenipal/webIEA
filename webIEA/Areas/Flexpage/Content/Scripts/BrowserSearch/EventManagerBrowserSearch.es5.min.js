"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},EventManager=EventManager||{},EventManagerBrowserSearch=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);EventManager.bus.subscribe(EventManager.settings.Events.browserSearch.showContextMenu,this.showContextMenu);EventManager.bus.subscribe(EventManager.settings.Events.browserSearch.clickContextMenu,this.clickContextMenu);EventManager.bus.subscribe(EventManager.settings.Events.browserSearch.downloadZip,this.downloadZip)}return _inherits(t,n),_createClass(t,[{key:"showContextMenu",value:function(n){var f=n.event,t,r,u,i;if(f.type="click",EventManager.tools.applyRename(f),$(n.blockCss+" .fp_gridNameValueInput").length===0){if(n.$elemClick=$(n.event.htmlEvent.target),n.blockCss=n.$elemClick.closest("table"),n.$block=n.$elemClick.closest("#b"+n.ID),n.$block.find(".fp_freeze").length===0)for(n.classRow="fp_gridNameValue",n.folderPerm=n.$block.find("#FolderPermissions").val(),t=EventManager.tools.showContextMenu_CheckAttrs(n),t==null||(n=t),n.path=n.$block.find("[name='SelectFolderName']").val()||n.$block.find("[name='PWFolderName']").val(),n.path||(n.path="\\"),n.perm=parseInt(n.$elemClick.closest(".main_row").attr("data-perm")),isNaN(n.perm)&&(n.perm=0),EventManager.tools.showContextMenu_CopyAttrs(n),r=eval("PopupMenu"+n.ID),n.$contextMenu=r,u=0;u<r.GetItemCount();u++){i=r.GetItem(u);switch(i.name){case"Delete":i.SetVisible((n.perm&4)>0&&t!=null);break;case"Copy":i.SetVisible(t!=null&&(n.perm&2)>0);break;case"Cut":i.SetVisible(t!=null&&(n.perm&4)>0&&(n.perm&2)>0);break;case"Download":i.SetVisible(t!=null);break;case"OpenInBrowser":i.SetVisible(t!=null)}}EventManager.tools.showContextMenu(n)}}},{key:"clickContextMenu",value:function(n){n.block=t.getActiveTab(n.ID);n.stopDownloadLink=!0;n.requestUrl="Browser/"+n.typeBlock+"_"+n.event.item.name;var i=EventManager.tools.clickContextMenu_GetAttrs(n);if(i==null||(n=i),n.$elemClick=$("#"+n.block.uniqueID),n.requestParameters={ID:n.ID,fileId:n.rowId,selectFolderName:n.selectFolderName},n.event.item.name==="Copy")n.block.GetSelectedFieldValues("ID",function(t){t&&t.length!==0||(t=[n.rowId]);var i={type:"files",selectedIDs:t.join(","),action:"DeepCopy"};EventManager.tools.set_cookie("PWBrowserCopyData",JSON.stringify(i),1800)});else if(n.event.item.name==="Cut")n.block.GetSelectedFieldValues("ID",function(t){t&&t.length!==0||(t=[n.rowId]);var i={type:"files",selectedIDs:t.join(","),action:"Cut"};EventManager.tools.set_cookie("PWBrowserCopyData",JSON.stringify(i),1800)});else if(n.event.item.name==="Download")n.block.GetSelectedFieldValues("ID",function(t){if(t&&t.length!==0){if(t.length>1){EventManager.bus.publish(EventManager.settings.Events.browserSearch.downloadZip,{values:t});return}}else t=[n.rowId];window.location.href="/Flexpage/DownloadFile?id="+t+"&revisionID=0"});else if(n.event.item.name==="Delete"){if(i==null)return;n.requestUrl="Flexpage/FolderContent_Delete";n.block.GetSelectedFieldValues("ID",function(i){i.length>0?fp_ConfirmDialog("Delete","Do you really want to delete the selected files?",function(){var u=i.length,r=0;i.forEach(function(i){n.rowId=i;n.$row=n.$elemClick.find(".fp_gridNameValue[data-rowid="+n.rowId+"]").closest(".main_row");fp_settings.debug==!0&&console.log("rowId:"+n.rowId);n.callbackSucceed=function(){r++;fp_settings.debug==!0&&console.log("callbackSucceed indexCallback:"+r);r==u&&(fp_settings.debug==!0&&console.log("indexCallback == length"),t.getActiveTab(n.ID).Refresh())};n.requestParameters={ID:n.ID,fileId:n.rowId,selectFolderName:n.selectFolderName};EventManager.bus.publish(EventManager.settings.Events.service.deleteFile,n)})}):fp_ConfirmDialog("Delete","Are you sure you want to delete file?",function(){n.$row=n.$elemClick.find(".fp_gridNameValue[data-rowid="+n.rowId+"]").closest(".main_row");n.callbackSucceed=function(){var i=t.getActiveTab(n.ID);i.Refresh()};EventManager.bus.publish(EventManager.settings.Events.service.deleteFile,n)})})}else n.event.item.name==="OpenInBrowser"&&(n.path=n.$elemClick.find(".fp_gridNameValue[data-rowid="+n.rowId+"]").attr("data-path"),$("div.fp_textTreeListNode").filter(function(t,i){return $(i).attr("data-path")==n.path}).first().click(),eval("fp_browserSearchTabs"+n.ID+".SetActiveTabIndex(0)"))}},{key:"downloadZip",value:function(n){if(n=n.values,!n||n.length===0){fp_ConfirmDialog("Warning","Please select files to upload",function(){});return}var t=n.join(",");window.location.href="/flexpage/FolderContentDownloadZip?ids="+t}}],[{key:"getActiveTab",value:function(n){var t=eval("fp_browserSearchTabs"+n+".GetActiveTabIndex()");return eval("fp_BrowserSearchResult_Grid"+n+"_"+t)}}]),t}(EventManagerBase);