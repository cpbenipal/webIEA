var EventManager=EventManager||{},contactDetailsEM;class EventManagerContactDetails extends EventManagerBase{constructor(){super();EventManager.bus.installTo(this);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.tabClick,this.update);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.edit,this.update);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.save,this.save);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.cancel,this.update);var n=this}save(n){EventManagerContactDetails.bind(n)}update(n){n.typeBlock="ContactDetails";n.requestUrl="Flexpage/"+n.typeBlock+"_UpdateTab";n.classBlock="fp_contactDetails";n=EventManagerContactDetails.getAttrs(n);n.requestParameters={blockID:n.ID,contactID:n.contactID,selectTab:n.selectTab,selectTabIndex:n.selectTabIndex,contactType:n.contactType,edit:n.edit};var t=n.$tab.html().trim();(t.length==0||n.reload==!0)&&(EventManager.tools.showLoading(n),n.callbackSucceed=function(n,t,i,r){EventManager.tools.UpdateTab(n,t,i,r)},EventManager.bus.publish(EventManager.settings.Events.service.updateContactDetails,n))}static getAttrs(n){n.$block=$(".flexpage-blockWrapper#b"+n.ID+" ."+n.classBlock+"");var t=n.event.tab;return t?(n.selectTab=t.name,n.selectTabIndex=t.index,n.$tab=n.$block.find("#tabControl"+n.ID+"_C"+n.selectTabIndex+" div")):(t=$(n.$block).find(".dxtc-activeTab:visible"),n.selectTab=t.text().replace(" ",""),n.selectTabIndex=t.attr("id").replace("tabControl"+n.ID+"_AT",""),n.$tab=t),n}static bind(n){$(".fp_contactDetails-btn__edit").on("click",{args:n},EventManagerContactDetails.eventEdit);$(".fp_contactDetails-btn__save").on("click",{args:n},EventManagerContactDetails.eventSave);$(".fp_contactDetails-btn__cancel").on("click",{args:n},EventManagerContactDetails.eventCancel);$(".fp_contactDetails-btn__generatePassword").on("click",{args:n},EventManagerContactDetails.eventGeneratePassword);$(".fp_contactDetails-btn__removeAuth").on("click",{args:n},EventManagerContactDetails.eventRemoveAuth)}static unbind(n){$(".fp_contactDetails-btn__edit").off("click",EventManagerContactDetails.eventEdit);$(".fp_contactDetails-btn__save").off("click",EventManagerContactDetails.eventSave);$(".fp_contactDetails-btn__cancel").off("click",EventManagerContactDetails.eventCancel);$(".fp_contactDetails-btn__generatePassword").off("click",{args:n},EventManagerContactDetails.eventGeneratePassword);$(".fp_contactDetails-btn__removeAuth").off("click",{args:n},EventManagerContactDetails.eventRemoveAuth)}static eventEdit(n){var t=n.data.args;EventManager.bus.publish(EventManager.settings.Events.contactDetails.edit,{event:n,ID:t.ID,contactID:t.contactID,contactType:t.contactType,edit:!0,reload:!0})}static eventSave(n){var t=n.data.args;$(n.target).closest("form").submit()}static eventCancel(n){var t=n.data.args;EventManager.bus.publish(EventManager.settings.Events.contactDetails.cancel,{event:n,ID:t.ID,contactID:t.contactID,contactType:t.contactType,edit:!1,reload:!0})}static eventGeneratePassword(n){var t=n.data.args;t.typeBlock="ContactDetails";t.requestUrl="Admin/ContactDetails_GeneratePassword";t.classBlock="fp_contactDetails";t=EventManagerContactDetails.getAttrs(t);t.callbackSucceed=function(n){$(t.$block).find("[name='Administration.Password']").attr("type","");$(t.$block).find("[name='Administration.Password']").val(n)};EventManager.bus.publish(EventManager.settings.Events.service.saveContactDetails,t)}static eventRemoveAuth(n){var t=n.data.args,i=confirm("Are you sure you want to delete login and password?");i&&(t=EventManagerContactDetails.getAttrs(t),$(t.$block).find("[name='Administration.Login']").val(""),$(t.$block).find("[name='Administration.Password']").val(""),$(t.$block).find("#formAdministration").submit())}}contactDetailsEM=new EventManagerContactDetails;
