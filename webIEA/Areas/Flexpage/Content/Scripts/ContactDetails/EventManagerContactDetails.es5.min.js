"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},EventManager=EventManager||{},EventManagerContactDetails=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);EventManager.bus.installTo(this);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.tabClick,this.update);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.edit,this.update);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.save,this.save);EventManager.bus.subscribe(EventManager.settings.Events.contactDetails.cancel,this.update);var n=this}return _inherits(t,n),_createClass(t,[{key:"save",value:function(n){t.bind(n)}},{key:"update",value:function(n){n.typeBlock="ContactDetails";n.requestUrl="ContactDetails/"+n.typeBlock+"_UpdateTab";n.classBlock="fp_contactDetails";n=t.getAttrs(n);n.requestParameters={blockID:n.ID,contactID:n.contactID,selectTab:n.selectTab,selectTabIndex:n.selectTabIndex,contactType:n.contactType,edit:n.edit};var i=n.$tab.html().trim();(i.length==0||n.reload==!0)&&(EventManager.tools.showLoading(n),n.callbackSucceed=function(n,t,i,r){EventManager.tools.UpdateTab(n,t,i,r)},EventManager.bus.publish(EventManager.settings.Events.service.updateContactDetails,n))}}],[{key:"toggleAddressCheckbox",value:function(n,t){var i=n.GetChecked();this.toggleAddressFields(!i,t);this.toggleAddressImportField(i)}},{key:"toggleAddressFields",value:function(n,t){for(var r=[StreetTextBox,ZipTextBox,CityTextBox,CountryComboBox,DescriptionTextBox],i=0;i<t;i++)r.push(eval("CustomPropertyEditor_"+i));r.forEach(function(t){return t.SetEnabled(n)})}},{key:"toggleAddressImportField",value:function(n){typeof LinkedAddressSource!="undefined"&&LinkedAddressSource.SetEnabled(n)}},{key:"setAddressValue",value:function(n){var i=LinkedAddressSource.GetValue(),t=JSON.parse(n.cpAllAddressViewsJson).filter(function(n){return n.ID===i})[0];StreetTextBox.SetValue(t.Street);ZipTextBox.SetValue(t.Zip);CityTextBox.SetValue(t.City);CountryComboBox.SetValue(t.CountryID);DescriptionTextBox.SetValue(t.Description);$("#SourceContactShortcutID").val(t.SourceContactShortcutID)}},{key:"getAttrs",value:function(n){n.$block=$(".flexpage-blockWrapper#b"+n.ID+" ."+n.classBlock+"");var t=n.event.tab;return t?(n.selectTab=t.name,n.selectTabIndex=t.index,n.$tab=n.$block.find("#tabControl"+n.ID+"_C"+n.selectTabIndex+" div")):(t=$(n.$block).find(".dxtc-activeTab:visible"),n.selectTab=t.text().replace(" ",""),n.selectTabIndex=t.attr("id").replace("tabControl"+n.ID+"_AT",""),n.$tab=t),n}},{key:"bind",value:function(n){$(".fp_contactDetails-btn__edit").on("click",{args:n},t.eventEdit);$(".fp_contactDetails-btn__save").on("click",{args:n},t.eventSave);$(".fp_contactDetails-btn__cancel").on("click",{args:n},t.eventCancel);$(".fp_contactDetails-btn__generatePassword").on("click",{args:n},t.eventGeneratePassword);$(".fp_contactDetails-btn__removeAuth").on("click",{args:n},t.eventRemoveAuth)}},{key:"unbind",value:function(n){$(".fp_contactDetails-btn__edit").off("click",t.eventEdit);$(".fp_contactDetails-btn__save").off("click",t.eventSave);$(".fp_contactDetails-btn__cancel").off("click",t.eventCancel);$(".fp_contactDetails-btn__generatePassword").off("click",{args:n},t.eventGeneratePassword);$(".fp_contactDetails-btn__removeAuth").off("click",{args:n},t.eventRemoveAuth)}},{key:"eventEdit",value:function(n){var t=n.data.args;EventManager.bus.publish(EventManager.settings.Events.contactDetails.edit,{event:n,ID:t.ID,contactID:t.contactID,contactType:t.contactType,edit:!0,reload:!0})}},{key:"eventSave",value:function(n){var t=n.data.args;$("[name='Administration.Login']").length>0&&($("[name='Administration.Login']").val(Login.GetValue()),$("[name='Administration.Password']").val(Password.GetValue()));$(n.target).closest("form").submit()}},{key:"eventCancel",value:function(n){var t=n.data.args;EventManager.bus.publish(EventManager.settings.Events.contactDetails.cancel,{event:n,ID:t.ID,contactID:t.contactID,contactType:t.contactType,edit:!1,reload:!0})}},{key:"eventGeneratePassword",value:function(n){var i=n.data.args;i.typeBlock="ContactDetails";i.requestUrl="Admin/ContactDetails_GeneratePassword";i.classBlock="fp_contactDetails";i=t.getAttrs(i);i.callbackSucceed=function(n){$(i.$block).find("[name='Administration.Password']").val(n);$(i.$block).find("[name='Password']").attr("type","");$(i.$block).find("[name='Password']").val(n)};EventManager.bus.publish(EventManager.settings.Events.service.saveContactDetails,i)}},{key:"eventRemoveAuth",value:function(n){var i=n.data.args,r=confirm("Are you sure you want to delete login and password?");r&&(i=t.getAttrs(i),$(i.$block).find("[name='Administration.Login']").val(""),$(i.$block).find("[name='Administration.Password']").val(""),$(i.$block).find("[name='Login']").val(""),$(i.$block).find("[name='Password']").val(""),$(i.$block).find("#formAdministration").submit())}}]),t}(EventManagerBase);