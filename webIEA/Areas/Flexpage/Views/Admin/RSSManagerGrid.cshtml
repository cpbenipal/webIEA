@using System.Web.UI.WebControls;

@(Html.DevExpress().GridView<Flexpage.Models.RSSModelFeed>(settings =>
{
    settings.Name = "fp_RSS_Grid";
    settings.CallbackRouteValues = new { Controller = "Admin", Action = "RSSGrid" };
    settings.SettingsEditing.DeleteRowRouteValues = new { Controller = "Admin", Action = "DeleteRss", ID = ViewData["ID"] };
    settings.Width = Unit.Percentage(100);

    settings.Styles.AlternatingRow.CssClass = "alternate_row";
    settings.Styles.Row.CssClass = "main_row";
    settings.Styles.CommandColumn.CssClass = "command";

    settings.KeyFieldName = "ID";
    settings.CommandColumn.Visible = true;

    settings.CommandColumn.CustomButtons.Add(new GridViewCommandColumnCustomButton() { ID = "btnRSSDelete", Text = "Delete" });

    settings.CommandColumn.Caption = "Actions";
    settings.CommandColumn.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;

    settings.Columns.Add(m => m.PublicationDate, column =>
    {
        column.ColumnType = MVCxGridViewColumnType.DateEdit;
        column.Width = new Unit(20, UnitType.Percentage);
        column.SortIndex = 0;
        column.SortOrder = DevExpress.Data.ColumnSortOrder.Ascending;
        column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
        column.Caption = "Publish Date";
    });
    settings.Columns.Add(m => m.ShortDescription, column =>
    {
        column.ColumnType = MVCxGridViewColumnType.Default;
        column.Width = new Unit(40, UnitType.Percentage);
        column.SortIndex = 1;
        column.SortOrder = DevExpress.Data.ColumnSortOrder.Ascending;
        column.HeaderStyle.HorizontalAlign = HorizontalAlign.Center;
        column.Caption = "Short description";
    });
    settings.Columns.Add(m => m.IsArchived, column =>
    {
        column.SetDataItemTemplateContent(c =>
        {
            column.Width = new Unit(15, UnitType.Percentage);
            column.HeaderStyle.HorizontalAlign = column.CellStyle.HorizontalAlign = HorizontalAlign.Center;
            column.Caption = "Archived";
            Html.DevExpress().CheckBox(checkboxSettings =>
            {
                checkboxSettings.Name = "cb_" + c.KeyValue.ToString();
                checkboxSettings.Properties.ClientSideEvents.ValueChanged = String.Format("function(s,e) {{ OnValueChanged(s,e,{0}); }}", c.KeyValue);
                if (ViewData.Model != null)
                {
                    foreach(Flexpage.Models.RSSModelFeed feed in ViewData.Model)
                    {
                        if(feed.ID == Convert.ToInt32(c.KeyValue.ToString()))
                        {
                            checkboxSettings.Checked = feed.IsArchived;
                        }
                    }
                }
            }).Render();
        });
    });
    settings.CommandColumn.ShowClearFilterButton = settings.Settings.ShowFilterRow = settings.Settings.ShowFilterRowMenu = true;
    settings.ClientSideEvents.CustomButtonClick = "fp_rssGrid_CustomButtonClick";
}).Bind(Model).GetHtml())
